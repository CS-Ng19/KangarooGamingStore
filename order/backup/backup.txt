<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Hypixel Rank</title>
    <link rel="stylesheet" href="hypixelrank/rankstyle.css" />
</head>
<body>
    <header>
        <img src="img/logo.png" id="logo" alt="Logo" />
        <h1>Hypixel&nbsp;Rank&nbsp;</h1>
        <p class="required-note1">
            ï¼Š ç‚ºå¿…å¡«æ¬„ä½ï¼Œæ‰€æœ‰ç”¢å“å‡ä»¥åŸåƒ¹æ¨™ç¤ºï¼Œæ‰€æœ‰åƒ¹æ ¼è«‹ä»¥
            <a href="https://docs.google.com/spreadsheets/d/1uOCRUG-QFxTyRp8vQ7dMWxzSc8lpHbcCfGHmvSqiy8s/edit">æœ€æ–°åƒ¹æ ¼</a>
            ç‚ºæº–ğŸ™
        </p>

    </header>
    <main>
        <form id="orderForm">
            <!-- ========== å•†å“æ¸…å–® (å¯è¤‡é¸) ========== -->
            <section class="product-list">
                <h2>é¸æ“‡å•†å“<span class="asterisk">*</span></h2>

                <!-- Hypixel Rank -->
                <fieldset class="product-block" data-product="Hypixel Rank">
                    <legend>
                        <label>
                            <input type="checkbox" class="prod-check" />
                            Hypixel Rank
                        </label>
                        <small class="desc">éé»‘å¡</small>
                    </legend>

                    <label class="required">Rank / åƒ¹æ ¼</label>
                    <select disabled class="variant">
                        <option disabled selected value="">è«‹é¸æ“‡</option>
                        <option value="VIP - 56">VIP - $56</option>
                        <option value="VIP+ - 128">VIP+ - $128</option>
                        <option value="MVP - 265">MVP - $265</option>
                        <option value="MVP+ - 368.5">MVP+ - $368.5</option>
                    </select>

                    <input type="hidden" class="qty" value="1" />
                </fieldset>

                <!-- [VIP] å‡ç´š -->
                <fieldset class="product-block" data-product="[VIP] å‡ç´š">
                    <legend>
                        <label>
                            <input type="checkbox" class="prod-check" />
                            [VIP] å‡ç´š 
                        </label>
                        <small class="desc">åƒ…é©ç”¨æ–¼ VIP å‡ç´š</small>
                    </legend>

                    <label class="required">Rank / åƒ¹æ ¼</label>
                    <select disabled class="variant">
                        <option disabled selected value="">è«‹é¸æ“‡</option>
                        <option value="VIP - 56">VIP - $56</option>
                        <option value="VIP+ - 128">VIP+ - $128</option>
                        <option value="MVP - 265">MVP - $265</option>
                        <option value="MVP+ - 368.5">MVP+ - $368.5</option>
                    </select>

                    <input type="hidden" class="qty" value="1" />
                </fieldset>

                <!-- [VIP+] å‡ç´š -->
                <fieldset class="product-block" data-product="[VIP+] å‡ç´š">
                    <legend>
                        <label>
                            <input type="checkbox" class="prod-check" />
                            [VIP+] å‡ç´š
                        </label>
                        <small class="desc">åƒ…é©ç”¨æ–¼ VIP+ å‡ç´š</small>
                    </legend>

                    <label class="required">Rank / åƒ¹æ ¼</label>
                    <select disabled class="variant">
                        <option disabled selected value="">è«‹é¸æ“‡</option>
                        <option value="MVP - 265">MVP - $265</option>
                        <option value="MVP+ - 368.5">MVP+ - $368.5</option>
                    </select>

                    <input type="hidden" class="qty" value="1" />
                </fieldset>

                <!-- [MVP] å‡ç´š -->
                <fieldset class="product-block" data-product="[MVP] å‡ç´š">
                    <legend>
                        <label>
                            <input type="checkbox" class="prod-check" />
                            [MVP] å‡ç´š
                        </label>
                        <small class="desc">åƒ…é©ç”¨æ–¼ MVP å‡ç´š</small>
                    </legend>

                    <label class="required">Rank / åƒ¹æ ¼</label>
                    <select disabled class="variant">
                        <option disabled selected value="">è«‹é¸æ“‡</option>
                        <option value="MVP+ - 368.5">MVP+ - $368.5</option>
                    </select>

                    <input type="hidden" class="qty" value="1" />
                </fieldset>

                <!-- ä»¥å„ªæƒ åƒ¹åŠ é… -->
                <fieldset class="product-block" data-product="å„ªæƒ åƒ¹åŠ é…">
                    <legend>
                        <label>
                            <input type="checkbox" class="prod-check" />
                            ä»¥å„ªæƒ åƒ¹åŠ é…
                        </label>
                        <small class="desc">å¯è³¼ 1â€“3 ä»¶</small>
                    </legend>

                    <label class="required">åŠ é… / åƒ¹æ ¼</label>
                    <select disabled class="variant">
                        <option disabled selected value="">è«‹é¸æ“‡</option>
                        <option value="Optifine Cape - 79">å…¨æ–° Optifine æŠ«é¢¨ - $79</option>
                        <option value="MC PC+Win10 Code - 142">Minecraft PC&Win10 å…Œæ›ç¢¼ - $142</option>
                    </select>

                    <label class="required">æ•¸é‡</label>
                    <input type="number" class="qty" disabled min="1" max="3" value="1" />
                </fieldset>
            </section>

            <!-- ========== ç¸½åƒ¹ ========== -->
            <div class="total">ç¸½åƒ¹ï¼š<span id="totalAmount">$0</span></div>

            <!-- ========== è³‡æ–™ ========== -->
            <section class="user">
                <label for="name" class="required">éŠæˆ²å…§åç¨± IGN</label>
                <input type="text" id="name" name="name" required />
                <label for="email" class="required">é›»éƒµ(ä»¥æ¥æ”¶æ”¶æ“š)</label>
                <input type="email" id="email" name="email" required />

                <label for="pay" class="required">æ”¯ä»˜æ–¹å¼</label>
                <select id="pay" name="pay" required>
                    <option disabled selected value="">è«‹é¸æ“‡æ”¯ä»˜æ–¹å¼</option>
                    <option>AlipayHK</option>
                    <option>WechatPayHK</option>
                    <option>Optopus Wallet</option>
                    <option>PayMe</option>
                    <option>Tap&amp;Go</option>
                    <option>FPSè½‰æ•¸å¿«</option>
                </select>

                <label for="note">å‚™æ³¨</label>
                <textarea id="note" name="note" rows="3"
                          placeholder="å¯è¼¸å…¥ç‰¹åˆ¥éœ€æ±‚â€¦"></textarea>
            </section>

            <button type="submit" id="submitBtn">æäº¤è¨‚å–®</button>
            <p id="msg"></p>
        </form>
    </main>

    <!-- ========= Footer & Social ========= -->
    <footer>
        <div class="social">
            <!-- Instagram -->
            <a href="https://www.carousell.com.hk/p/vip-43-hypixel-rank-%E4%BB%A3%E8%B3%BC-1326716830/" class="social-btn carou" aria-label="carousell">
                <img src="img/smallcarou.png" id="logo" alt="Logo" height="33"/>
            </a>
        </div class="social">
                <p class="copyright"> 2025 Kangaroo Gaming Store</p>
</footer>

    <!-- ================= JavaScript ================= -->
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwVyNArdT1tqkhQUxiEIp8mrI7EfdwsZeNywSQ157kxG_N00ungdNEo9NYIMXojaw8-tA/exec"; 
        const genOrderId = () =>
            Math.floor(10000 + Math.random() * 90000).toString();

        /* åƒ¹æ ¼è¡¨ (HKD) */
        const priceMap = {
            "VIP - 56": 56,
            "VIP+ - 128": 128,
            "MVP - 265": 265,
            "MVP+ - 368.5": 368.5,
            "Optifine Cape - 79": 79,
            "MC PC+Win10 Code - 142": 142
        };

        /* === DOM === */
        const totalAmtEl = document.getElementById("totalAmount");

        /* === å•Ÿç”¨ / åœç”¨æ¬„ä½ === */
        document.querySelectorAll(".product-block").forEach(block => {
            const chk = block.querySelector(".prod-check");
            const varnt = block.querySelector(".variant");
            const qty = block.querySelector(".qty");

            chk.addEventListener("change", () => {
                const on = chk.checked;
                varnt.disabled = !on;
                qty.disabled = !on;
                if (!on) {
                    varnt.selectedIndex = 0;
                    qty.value = qty.type === "number" ? 1 : qty.value;
                }
                calcTotal();
            });

            varnt.addEventListener("change", calcTotal);
            if (qty.type === "number") qty.addEventListener("input", calcTotal);
        });

        /* === è¨ˆç®—ç¸½åƒ¹ === */
        function calcTotal() {
            let sum = 0;
            document.querySelectorAll(".product-block").forEach(b => {
                if (!b.querySelector(".prod-check").checked) return;
                const v = b.querySelector(".variant").value;
                const q = Number(b.querySelector(".qty").value || 1);
                if (v && priceMap[v] !== undefined) {
                    sum += priceMap[v] * q;
                }
            });
            totalAmtEl.textContent = "$" + sum.toFixed(1).replace(/\.0$/, "");
            return sum;
        }

        /* === æäº¤è¡¨å–® === */
        document.getElementById("orderForm").addEventListener("submit", async e => {
            e.preventDefault();
            const f = e.target;
            const btn = submitBtn;
            const msg = document.getElementById("msg");

            const items = [];
            document.querySelectorAll(".product-block").forEach(b => {
                if (!b.querySelector(".prod-check").checked) return;
                const product = b.dataset.product;
                const variant = b.querySelector(".variant").value;
                const qty = b.querySelector(".qty").value;
                items.push({ product, variant, qty });
            });

            if (items.length === 0) {
                msg.textContent = "è«‹è‡³å°‘é¸æ“‡ä¸€ä»¶å•†å“";
                return;
            }

            if (!f.checkValidity()) {
                msg.textContent = "è«‹å®Œæ•´å¡«å¯«æ¨™è¨˜ * çš„æ¬„ä½";
                return;
            }

            const total = calcTotal();

            const data = {
                orderId: genOrderId(),
                name: f.name.value.trim(),
                email: f.email.value.trim(),
                pay: f.pay.value,
                note: f.note.value.trim(),
                total,
                items
            };

            btn.disabled = true;
            msg.textContent = "æäº¤ä¸­â€¦";

            try {
                await fetch(SCRIPT_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });
                msg.textContent = `ä¸‹å–®æˆåŠŸï¼è¨‚å–®ç·¨è™Ÿï¼š${data.orderId}`;
                f.reset();
                document.querySelectorAll(".product-block").forEach(b => {
                    b.querySelector(".variant").disabled = true;
                    b.querySelector(".qty").disabled = true;
                });
                totalAmtEl.textContent = "$0";
            } catch (err) {
                console.error(err);
                msg.textContent = "æäº¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ // Please dm to report.";
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>